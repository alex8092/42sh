#include "ft_buildins_private.h"
#include <stdio.h>
#include <common.h>
#include <stdlib.h>
#include "ft_environment.h"
#include <sys/stat.h>

static char *ft_find_pwd(char *begin, char *end, int i)
{
	char	*result;
	char	*tmp;

	result = NULL;
	tmp = NULL;
	if (begin)
	{
		tmp = ft_strjoin(begin, "/");
		if (!end)
			result = ft_strdup(tmp);
		else
			result = ft_strjoin(tmp, (end + i));
		free(tmp);
	}
	return (result);
}

static char *ft_find_chemin(char *chemin)
{
	char	*pwd;
	
	pwd = NULL;
	if (chemin[0] == '-' && !chemin[1])
		pwd = ft_find_pwd(env_singleton()->get("OLDPWD"), NULL, 0);
	else if (chemin[0] == '~' && chemin[1] == '/')
		pwd = ft_find_pwd(env_singleton()->get("HOME"), chemin, 2);
	else
		pwd = ft_find_pwd(env_singleton()->get("PWD"), chemin, 0);
	return (pwd);
}

void	p_buildins_cd(char **argv)
{
	char 		*chemin;

	if (argv[1])
	{
		chemin = ft_find_chemin(argv[1]);
		printf("%s\n", chemin);
	}
}
